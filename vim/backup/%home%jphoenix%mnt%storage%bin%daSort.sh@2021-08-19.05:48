#!/bin/bash
#for file in *; do name=${file##*by_}; name=${name%%.jpg}; name=${name%%-d*}; name=${name%%-fullview*}; name=${name%%_d*}; echo $name; done | sort | uniq -c | sort -n

BASE=/home/jphoenix/mnt/storage/seiko/Pics/Pics.dA
UNSORT=$BASE/zzz.unsorted
PRESORT=$BASE/zzz.presorted
SORT=$BASE/sorted
FAVES=/home/jphoenix/mnt/storage/seiko/Pics/Pics.girls/dA-Faves
DEBUG=true

$DEBUG || find $UNSORT -type f -name "*by*" -exec mv -v {} $PRESORT \;

for file in $PRESORT/*; do
	name=${file##*by_}
	name=${name%%.jpg}
	name=${name%%-d*}
	name=${name%%-fullview*}
	name=${name%%_d*}
	if [ -d $FAVES/$name ]; then
#		echo "Moving $file to $FAVES/$name..."
		$DEBUG && echo "Moving $file to $FAVES/$name..." || mv -v $file $FAVES/$name
	else
		if [ ! -d $SORT/$name ]; then
			$DEBUG && echo "Making dir $name..." || mkdir -pv $SORT/$name
		fi
		$DEBUG && echo "Moving $file to $SORT/$name..." || mv -v $file $SORT/$name
	fi
#	elif [ ! -d $SORT/$name ]; then
#		mkdir $SORT/$name
#		echo "Making dir $name and moving $file..."
#	else
#		echo "Moving $file to $SORT/$name..."
done
