#!/bin/bash
## Scoop backups for my Yuno instances

HOME=/home/jphoenix
LOGFILE=$HOME/log/getBackups.log

#RS_OPTS="-trivzP --partial-dir=.rsync-part/ --info=progress --exclude=*.json --log-file=${LOGFILE} $@"

RS_OPTS=-trivzP --partial-dir=.rsync-part/ --info=progress --log-file=${LOGFILE} $@


R_DIR="/home/yunohost.backup"
L_DIR="/home/jphoenix/local/Backup/sites"

for DOMAIN in `ls ${L_DIR} | grep -v "clear.sh"`; do
	DOMAIN=${DOMAIN%%/}
	echo "Domain: ${DOMAIN}\n"
	rsync ${RS_OPTS} --files-from=<(ssh ${DOMAIN} 'find ${R_DIR} -type f -mtime -7') ${DOMAIN}:/ ${L_DIR}/${DOMAIN}
done


#rsync $RS_OPTS sagephoenix.org:$R_DIR/ $L_DIR/sagephoenix.org/

#rsync $RS_OPTS phoeni.xyz:$R_DIR/ $L_DIR/phoeni.xyz/

#rsync $RS_OPTS moonbeam.town:$R_DIR/ $L_DIR/moonbeam.town/

# rsync -ahrv --update --files-from=<(ssh moonbeam.town 'find /home/yunohost.backup -type f -mtime -7') moonbeam.town:/ moonbeam.town/
